<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>La Rivera – Orders</title>
  <link rel="stylesheet" href="css/styles.css"/>
  <style>
    .order{background:#12121a;border:1px solid #1e1e2a;border-radius:12px;margin:0 0 1rem;padding:1rem}
    .order-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:.5rem}
    .order-items{font-size:.95rem}
    .order-items .row{border-bottom:0}
    .muted{color:var(--muted)}
  </style>
</head>
<body>
  <nav class="nav container">
    <div class="brand">La <em>Rivera</em></div>
    <div>
      <a href="index.html">Home</a>
      <a href="catalog.html">Catalog</a>
      <a href="account.html">Account</a>
      <a href="#" id="logout">Logout</a>
    </div>
  </nav>

  <section class="container">
    <div class="topbar">
      <div><div class="badge">Order History</div><h2 style="margin:.25rem 0 0">Your Orders</h2></div>
    </div>
    <div id="orders"></div>
  </section>

  <footer class="footer container">© La Rivera.</footer>

  <script type="module">
    import { apiGet } from './js/api.js';
    const token = localStorage.getItem('token'); if(!token){ window.location.href='login.html'; }
    document.getElementById('logout').onclick = () => { localStorage.removeItem('token'); localStorage.removeItem('user'); window.location.href = 'index.html'; };

    const container = document.getElementById('orders');
    const fmt = c => '₹'+(c/100).toFixed(2);
    const fmtDate = iso => { try{ return new Date(iso).toLocaleString(); } catch { return iso; } };

    async function load(){
      const { orders } = await apiGet('/api/orders', true);
      container.innerHTML = '';
      if(!orders || orders.length===0){
        const empty = document.createElement('div');
        empty.className='cart';
        empty.textContent='You have not placed any orders yet.';
        container.appendChild(empty);
        return;
      }
      for(const o of orders){
        const card = document.createElement('div');
        card.className = 'order';
        card.innerHTML = `
          <div class="order-header">
            <div>
              <div style="font-weight:700">Order #${String(o.id).slice(0,8)}</div>
              <div class="muted">Placed on ${fmtDate(o.created_at)}</div>
            </div>
            <div class="price" style="font-size:1.1rem">${fmt(o.total_cents)}</div>
          </div>
          <div class="order-items">
            ${o.line_items.map(i => `
              <div class="row"><div>${i.name} × ${i.qty}</div><div>${fmt(i.subtotal_cents)}</div></div>
            `).join('')}
            <div class="total">Total: ${fmt(o.total_cents)}</div>
          </div>
        `;
        container.appendChild(card);
      }
    }
    load();
  </script>
</body>
</html>